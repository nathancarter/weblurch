<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Part 2, Code-based rules - webLurch Documentation</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">webLurch Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Authors <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">User guide</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../">Introduction</a>
</li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Basics</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../basics-intro/">Overview</a>
</li>

        
            
<li >
    <a href="../basics-1/">Part 1, The editor</a>
</li>

        
            
<li >
    <a href="../basics-2/">Part 2, Expressions and canonical form</a>
</li>

        
            
<li >
    <a href="../basics-3/">Part 3, Connections and attributes</a>
</li>

        
            
<li >
    <a href="../basics-4/">Part 4, Steps and Reasons</a>
</li>

        
            
<li >
    <a href="../basics-5/">Part 5, Rules in Dependencies</a>
</li>

        
            
<li >
    <a href="../basics-6/">Part 6, Connecting Dependencies</a>
</li>

        
    </ul>
  </li>

        
            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Technicalities</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../tech-intro/">Overview</a>
</li>

        
            
<li >
    <a href="../tech-1/">Part 1, Code attributes</a>
</li>

        
            
<li class="active">
    <a href="./">Part 2, Code-based rules</a>
</li>

        
    </ul>
  </li>

        
    </ul>
  </li>

                    
                        
<li >
    <a href="../../embedding/">Blog/website embedding</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../developer/">Introduction</a>
</li>

                    
                        
<li >
    <a href="../../getting-started/">Getting started</a>
</li>

                    
                        
<li >
    <a href="../../dev-tutorial/">Tutorial</a>
</li>

                    
                        
<li >
    <a href="../../plan/">Project plan</a>
</li>

                    
                        
<li >
    <a href="../../bugs-and-enhancements/">Bug fix/enhancement list</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples and Demos <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../example-apps/">Full list</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Lean demo app</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../lean-example/tutorial-1/">Tutorial Part 1</a>
</li>

        
            
<li >
    <a href="../../lean-example/tutorial-2/">Tutorial Part 2</a>
</li>

        
            
<li >
    <a href="../../lean-example/tutorial-3/">Tutorial Part 3</a>
</li>

        
            
<li >
    <a href="../../lean-example/tutorial-4/">Tutorial Part 4</a>
</li>

        
            
<li >
    <a href="../../lean-example/tutorial-5/">Tutorial Part 5</a>
</li>

        
            
<li >
    <a href="../../lean-example/tutorial-6/">Tutorial Part 6</a>
</li>

        
            
<li >
    <a href="../../lean-example/tutorial-7/">Tutorial Part 7</a>
</li>

        
            
<li >
    <a href="../../lean-example/tutorial-8/">Tutorial Part 8</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../tech-1/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../embedding/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#technicalities-part-2-code-based-rules">Technicalities, Part 2: Code-based Rules</a></li>
        
            <li><a href="#writing-a-code-based-rule">Writing a code-based rule</a></li>
        
            <li><a href="#example">Example</a></li>
        
            <li><a href="#editing-and-debugging">Editing and debugging</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="technicalities-part-2-code-based-rules">Technicalities, Part 2: Code-based Rules</h1>
<p>A code-based rule is an atomic expression in the document containing code
that can evaluate steps of a user's work, and return data about the validity
of that step of work (including not only whether the step is valid, but also
an explanation to the user about why).</p>
<h2 id="writing-a-code-based-rule">Writing a code-based rule</h2>
<p>To write a code-based rule, follow these steps.</p>
<ol>
<li>Create an atomic expression that will contain the code.</li>
<li>Give it an attribute with key "code" and with value "JavaScript",
    as in the previous page of this User Guide.</li>
<li>Give it an attribute with key "rule" and with any value, such as "yes".</li>
<li>Give it a label, so that users can cite it.  For instance, if your rule
    will judge simple statements of arithmetic, you might label your rule
    "simple arithmetic", so that users can say that a step of their work is
    true by simple arithmetic.</li>
<li>Write code that will be used as the body of a function.  The function
    takes two parameters, <code>conclusion</code> and <code>premises</code>.  The first is an
    OpenMath structure about the expression to be judged.  The second is an
    array of such structures, for each cited premise.  Your code should
    return an object with two members:<ul>
<li><code>result</code> - a string, one of "valid", "invalid", or "intermediate"</li>
<li><code>message</code> - a string, a short message to show to users who hover over
   the validation icon</li>
</ul>
</li>
</ol>
<h2 id="example">Example</h2>
<p>Here is a code-based rule that judges whether an atomic expression contains
the letter x.  If so, it calls that expression valid; if not, then invalid.
(Surely, this rule is useless, except as a simple example.)</p>
<div class='lurch-embed'><shorthand>
<p>I'll call this the <e at='label' to='1'>X rule</e>:</p>
<p><e n='1'><e at='code'>javascript</e><e at='rule'>yes</e>var hasX =
    /x/i.test( conclusion.value );<br>
return {<br>
&emsp;result : hasX ? 'valid' : 'invalid',<br>
&emsp;message : hasX ? 'This contains an X.' : 'This contains no X.'<br>
};</p>
<p>Now let's try using the rule, once correctly, and once incorrectly.</p>
<p>I think that <e n='2'>excellent</e> should be marked valid
    and <e n='3'>awesome</e> should be marked invalid by the
    <e at='reason' to='2,3'>X rule</e>.</p>
</shorthand></div>

<h2 id="editing-and-debugging">Editing and debugging</h2>
<p>If you edit the document, the validation results should update in real time
in response to your edits.  For instance, if you change the rule citation
to "Y rule", both expressions citing it should be marked invalid because
there is no such rule.  You can even edit the code of the rule; if it is in
a syntactically invalid state, anything citing it will be marked invalid,
with an internal rule error as the explanation.</p>
<p>When writing the code for a rule, don't forget that you can right-click the
rule and choose "Edit as code" to use an editor with syntax highlighting.
Rules are evaluated in a separate thread without access to the DOM or the
browser window, so you cannot harm the Lurch application itself.  But you
can use the <code>console.log</code> command to dump data to the console and inspect
its structure.</p>
<p>The conclusion and premise objects are both instances of the <code>OMNode</code> class
defined in <a href="https://github.com/nathancarter/weblurch/blob/master/src/openmath-duo.litcoffee">this source code
file</a>.
Documentation on the class is included in the source code itself.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>
        <script src="http://nathancarter.github.io/weblurch/app/lurch-embed-solo.min.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>