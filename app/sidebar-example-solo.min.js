(function(){var addFormsAndCategoriesToToolbar,addMathQuillCSS,allNaturalLanguages,codeFormHierarchy,codeFormTranslators,formsAndCategories,groupToExplanation,isGroupRight,lastLanguageChoice,makeSelect,makeText,makeTextarea,markGroupRight,markGroupWith,markGroupWrong,menuItems,niceText,runTranslation,topLevelCategories,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},__slice=[].slice;setAppName("SidebarApp"),addHelpMenuSourceCodeLink("app/sidebar-example-solo.litcoffee"),window.helpAboutText='<p>See the fully documented <a target="top" href="https://github.com/nathancarter/weblurch/blob/master/app/sidebar-example-solo.litcoffee" >source code for this demo app</a>.</p>',formsAndCategories={},topLevelCategories=function(){var e,t,n,r,o,a,i,l,s,d;e=[],n=[];for(r in formsAndCategories)if(__hasProp.call(formsAndCategories,r)&&(t=formsAndCategories[r],"category"===t.type))for(e.push(r),s=t.contents,o=0,i=s.length;i>o;o++)r=s[o],__indexOf.call(n,r)<0&&n.push(r);for(d=[],a=0,l=e.length;l>a;a++)r=e[a],__indexOf.call(n,r)<0&&d.push(r);return d},codeFormHierarchy=function(e){var t,n,r,o,a,i,l,s,d;for(t=[],o=function(t){return{text:t,onclick:null!=e?function(){return e(t)}:function(){var e,n,r,o,a,i,l,s,d,c,u,p,g;if(r=tinymce.activeEditor,n=codeFormTranslators[t].example.en,null==n||!(null!=r&&null!=(p=r.selection)&&null!=(g=p.getRng())?g.collapsed:void 0))return o=r.Groups.groupCurrentSelection("codexp"),void o.set("tagName",t);for(l=[],s={},a="";d=/<(\/?)([^>]+)>/.exec(n);)a+=n.slice(0,d.index),codeFormTranslators.hasOwnProperty(d[2])?(""===d[1]?(c="open",l.push(i=r.Groups.nextFreeId())):(c="close",i=l.pop()),s[i]=d[2],a+=grouperHTML("codexp",c,i,!1,r.Groups.groupTypes.codexp[""+c+"Image"])):a+=d[0],e=d.index+d[0].length,n=n.slice(e);a+=n,r.insertContent(a);for(i in s)__hasProp.call(s,i)&&(u=s[i],r.Groups[i].set("tagName",u));return $(r.getDoc()).find(".math").each(function(e,t){return t.setAttribute("contenteditable","false"),$(t).addClass("rendered-latex"),$(t).mathquill()})}}},r=function(e){var n;return __indexOf.call(t,e)>=0?{text:e,menu:[]}:(t.push(e),{text:e,menu:function(){var t,r,o,i;for(o=formsAndCategories[e].contents,i=[],t=0,r=o.length;r>t;t++)n=o[t],i.push(a(n));return i}()})},a=function(e){return"form"===formsAndCategories[e].type?o(e):r(e)},s=topLevelCategories(),d=[],i=0,l=s.length;l>i;i++)n=s[i],d.push(a(n));return d},addFormsAndCategoriesToToolbar=function(){var e,t,n,r,o;for(window.groupToolbarButtons={},e=1,o=codeFormHierarchy(),n=0,r=o.length;r>n;n++)t=o[n],t.type="menubutton",window.groupToolbarButtons["category"+e++]=t;return window.groupToolbarButtons.toggleSidebar={text:"Toggle code view",onclick:function(){var e,t;return e=document.getElementById("sidebar"),t=window.splitter.find(".vsplitter").get(0),"none"===e.style.display?(e.style.display="block",t.style.display="block",splitter.position(splitter.position())):(e.style.display="none",t.style.display="none",window.editorContainer.style.width="100%")}}},window.registerCodeForm=function(e,t){return formsAndCategories[e]={type:"form",validator:t},addFormsAndCategoriesToToolbar(),e},window.registerCategory=function(e,t){return formsAndCategories[e]={type:"category",contents:t},addFormsAndCategoriesToToolbar(),e},codeFormTranslators={},window.registerTranslator=function(e,t,n,r){var o,a;return null==codeFormTranslators[e]&&(codeFormTranslators[e]={}),null==(o=codeFormTranslators[e])[n]&&(o[n]={}),null!=(a=codeFormTranslators[e][n])[t]?a[t]:a[t]=r},runTranslation=function(e,t,n){var r,o,a,i,l,s,d,c,u,p,g,h,m;if(u=function(e){return runTranslation(e,t,n)},i=e.get("tagName"),!codeFormTranslators.hasOwnProperty(i))return"Translation error: Form "+i+" has no translators registered";if(!codeFormTranslators[i].hasOwnProperty(n))return"Translation error: Form "+i+" has no translators of type "+n+" registered";if(!codeFormTranslators[i][n].hasOwnProperty(t))return"Translation error: Form "+i+" has no "+t+" translators of type "+n+" registered";if(p=codeFormTranslators[i][n][t],"string"==typeof p){for(s="ABCDEFGHIJKLMNOPQRSTUVWXYZ",d=0;-1<p.indexOf("__"+s[d]+"__");)d++;if(e.children.length!==d)return"Translation error: Form "+i+" requires "+d+" parts, but contains only "+e.children.length;for(m=e.children,l=g=0,h=m.length;h>g;l=++g){if(r=m[l],c="__"+s[l]+"__",o=u(r),/^Translation error/.test(o))return o;p=p.replace(RegExp(c,"g"),o)}return p}try{return p(e,u)}catch(f){return a=f,console.log("User-defined translator error:",a)}},window.groupContentsChanged=function(e,t){return window.validate(e)},window.groupDeleted=function(e){var t;if(null!=e.parent){if(e.parent.children[0])return window.validate(e.parent.children[0])}else if(null!=(t=e.plugin)?t.topLevel[0]:void 0)return window.validate(e.plugin.topLevel[0])},menuItems=function(e){return[{text:"Change this to...",menu:codeFormHierarchy(function(t){return e.set("tagName",t)})},{text:"Explain this...",onclick:function(){var t,n,r,o,a;for(t="",a=allNaturalLanguages(),r=0,o=a.length;o>r;r++)n=a[r],t+="<h2>Language: "+n+"</h2>\n"+groupToExplanation(e,n);return tinymce.activeEditor.Dialogs.alert({title:"Explanation of one structure",message:addMathQuillCSS(t),width:600,height:450})}},{text:"Explain all...",onclick:function(){var t,n,r,o,a,i,l,s;for(t="",l=allNaturalLanguages(),r=0,a=l.length;a>r;r++)for(n=l[r],t+="<h2>Language: "+n+"</h2>\n",s=tinymce.activeEditor.Groups.topLevel,o=0,i=s.length;i>o;o++)e=s[o],""!==t&&(t+="<hr>"),t+=groupToExplanation(e,n);return tinymce.activeEditor.Dialogs.alert({title:"Explanation of all structures",message:addMathQuillCSS(t),width:600,height:450})}}]},allNaturalLanguages=function(){var e,t,n,r,o;r=[];for(t in codeFormTranslators)if(__hasProp.call(codeFormTranslators,t)){e=codeFormTranslators[t],o=e.explanation;for(n in o)__hasProp.call(o,n)&&__indexOf.call(r,n)<0&&r.push(n)}return r},addMathQuillCSS=function(e){var t;return t=window.location.href.split("/").slice(0,-1).join("/"),"<html> <head><link rel='stylesheet' href='"+t+"/eqed/mathquill.css'></head> <head><link rel='stylesheet' href='"+t+"/groupsplugin.css'></head> <body>"+e+"</body> </html>"},groupToExplanation=function(e,t){return"<h4>Structure:</h4>\n <p style='margin-left: 2em;'>"+e.groupAsHTML()+"</p>\n <h4>Explanation:</h4>\n <p style='margin-left: 2em;' >"+runTranslation(e,t,"explanation")+"</p>\n"},window.groupTypes=[{name:"codexp",color:"#6666cc",text:"Code expression",tooltip:"Tag the selection",imageHTML:'<font color="#6666cc">[ ]</font>',openImageHTML:'<font color="#6666cc">[</font>',closeImageHTML:'<font color="#6666cc">]</font>',onToolbar:!1,contentsChanged:window.groupContentsChanged,deleted:window.groupDeleted,tagContents:function(e){return e.get("tagName")},tagMenuItems:function(e){return menuItems(e)},contextMenuItems:function(e){return menuItems(e)}}],markGroupRight=function(e){return e.set("valid",!0),e.clear("closeDecoration"),e.clear("closeHoverText"),window.createSidebarContent()},markGroupWrong=function(e,t){return e.set("valid",!1),e.set("closeDecoration",'<font color="red">&#10006;</font>'),e.set("closeHoverText",t),window.createSidebarContent()},markGroupWith=function(e,t){return e.set("validationResult",t),"valid"===t.result?markGroupRight(e):markGroupWrong(e,t.message)},isGroupRight=function(e){return e.get("valid")},window.validate=function(e,t){var n,r,o,a,i,l,s,d,c,u;if(!e.children)return void setTimeout(function(){return window.validate(e)},100);if(null==(a=e.get("tagName")))return markGroupWith(e,{result:"invalid",message:"Each group must have a tag, but this one does not.  Add a tag using the context menu."});if(d=formsAndCategories[a].validator,d instanceof Array){if(s={result:"valid",message:"All inner groups have the correct types."},o=e.children,d.length!==o.length)return markGroupWith(e,{result:"invalid",message:"This form needs "+d.length+" parts: "+d.join(", ")+"."});for(i=c=0,u=o.length;u>c;i=++c)if(n=o[i],r=n.get("tagName"),l=d[i].split("/"),__indexOf.call(l,r)<0)return markGroupWith(e,{result:"invalid",message:"Part "+(i+1)+" must be of type "+d[i]+", but it is of type "+r+" instead."})}else s=d(e,t);return markGroupWith(e,s)},window.fullScreenEditor=!1,window.editorContainer=function(){return document.getElementById("editorContainer")},window.afterEditorReady=function(e){var t,n;return n=window.editorContainer.parentNode,t=function(){var t,r,o;return t=e.getContainer(),r=e.getContentAreaContainer().firstChild,o=tinymce.DOM.getViewPort(),r.style.width=r.style.height=n.style.height="100%",t.style.width=t.style.height="",r.style.height=n.clientHeight-2-(t.clientHeight-r.clientHeight),window.scrollTo(o.x,o.y)},window.splitter=$(n).split({orientation:"vertical",limit:100,position:"75%",onDrag:t}),$(window).resize(t),t(),window.createSidebarContent()},window.createSidebarContent=function(){var e,t,n,r,o,a;for(n=document.getElementById("sidebar"),n.innerHTML="<div style=\"border-bottom: solid 1px black;\n            text-align: center;\">\n    <p>Choose a language:\n    <select onchange='updateSidebarContent();'\n            id='languagePicker'>\n        <option value='javascript'>JavaScript</option>\n        <option value='python'>Python</option>\n        <option value='r'>R</option>\n    </select></p>\n    <p id='runJSLink'><a href='#'\n        onclick='runGeneratedJavaScript();'\n        >Run this code</a></p>\n    <p><a href='#' onclick='copyGeneratedCode();'\n        >Copy this code</a></p>\n</div>",$("#languagePicker").val(lastLanguageChoice),$("#runJSLink").get(0).style.display="javascript"===lastLanguageChoice?"block":"none",window.lastSidebarContent="",a=tinymce.activeEditor.Groups.topLevel,r=0,o=a.length;o>r;r++)t=a[r],e=document.createElement("div"),e.setAttribute("id","codeForGroup"+t.id()),$(e).click(t.id(),function(e){return t=tinymce.activeEditor.Groups[e.data],tinymce.activeEditor.selection.setRng(t.innerRange())}),e.style.padding="1em",e.style.borderBottom="dotted 1px black",e.innerHTML=window.createSidebarEntryHTML(t),n.appendChild(e),lastSidebarContent+=e.textContent+"\n";return $(n).find("pre").each(function(e,t){return hljs.highlightBlock(t)})},lastLanguageChoice="javascript",window.updateSidebarContent=function(){return lastLanguageChoice=$("#languagePicker").val(),createSidebarContent()},window.runGeneratedJavaScript=function(){var e;try{return eval(lastSidebarContent)}catch(_error){return e=_error,alert("Error when running code:\n\n"+e.message)}},window.copyGeneratedCode=function(){return tinymce.activeEditor.Dialogs.alert({title:"Copy the code, then close",width:600,message:"<textarea id='codeToCopy'\n          style='width: 100%; height: 100%;\n                 font-family: monospace;'\n    >"+lastSidebarContent+"</textarea>\n<script>\n    var T = document.getElementById( 'codeToCopy' );\n    T.select();\n    T.focus();\n</script>"})},window.createSidebarEntryHTML=function(e){var t,n,r;return t=runTranslation(e,lastLanguageChoice,"code"),n=codeFormTranslators.COMMENT.code[lastLanguageChoice],r=n.replace("__A__",niceText.apply(null,e.contentNodes())),r+="\n"+(/^Translation error/.test(t)?n.replace("__A__",t):t),"<pre class='javascript'>"+r+"</pre>"},niceText=function(){var e,t,n,r,o;for(t=1<=arguments.length?__slice.call(arguments,0):[],n="",r=0,o=t.length;o>r;r++)e=t[r],n+=3===(null!=e?e.nodeType:void 0)?e.textContent:$(e).hasClass("mathquill-rendered-math")?e.childNodes[0].textContent:niceText.apply(null,e.childNodes);return n},setInterval(function(){var e,t;if(t=tinymce.activeEditor.selection.getRng(),$(sidebar).find("div").css("background-color","#fff"),e=tinymce.activeEditor.Groups.groupAboveSelection(t)){for(;e.parent;)e=e.parent;return $("#codeForGroup"+e.id()).css("background-color","#eee")}},100),window.openInJSFiddle=function(e){var t,n;return n=String.fromCharCode(160),e=e.replace(RegExp(n,"g")," "),t=document.createElement("form"),t.setAttribute("method","post"),t.setAttribute("action","http://jsfiddle.net/api/post/mootools/1.2/dependencies/more/"),t.setAttribute("target","_blank"),t.style.display="none",t.appendChild(makeSelect("panel_html",{0:"HTML"})),t.appendChild(makeTextarea("html")),t.appendChild(makeSelect("panel_js",{0:"JavaScript",1:"CoffeeScript",2:"JavaScript 1.7"})),t.appendChild(makeTextarea("js",e)),t.appendChild(makeSelect("panel_css",{0:"CSS",1:"SCSS"})),t.appendChild(makeTextarea("css")),t.appendChild(makeText("title","Fiddle Title Here")),t.appendChild(makeTextarea("description","Fiddle Description Here")),t.appendChild(makeTextarea("resources")),t.appendChild(makeText("dtd","html 4")),t.appendChild(makeText("wrap","l")),document.body.appendChild(t),t.submit(),document.body.removeChild(t)},makeSelect=function(e,t){var n,r,o,a;o=document.createElement("select"),o.setAttribute("name",e);for(a in t)__hasProp.call(t,a)&&(r=t[a],n=document.createElement("option"),n.setAttribute("value",a),n.innerHTML=r,o.appendChild(n));return o},makeTextarea=function(e,t){var n;return n=document.createElement("textarea"),n.setAttribute("name",e),n.innerHTML=t||"",n},makeText=function(e,t){var n;return n=document.createElement("input"),n.setAttribute("type","text"),n.setAttribute("name",e),n.setAttribute("value",t),n}}).call(this);
//# sourceMappingURL=sidebar-example-solo.min.js.map