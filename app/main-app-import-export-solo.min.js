(function(){var e,t,i=[].slice;window.groupMenuItems.wikiimport={text:"Import from wiki...",context:"file",onclick:function(){var t;if(!e()&&(t=prompt("Give the name of the page to import (case sensitive)","Main Page"),null!==t))return tinymce.activeEditor.MediaWiki.importPage(t,function(e,t){return null!=t?tinymce.activeEditor.Settings.document.metadata=t:void 0})}},window.groupMenuItems.wikiexport={text:"Export to wiki",context:"file",onclick:function(){var t,i,o,n,a;if(!e())return i=tinymce.activeEditor.Settings.document.get("wiki_title"),null==i?void tinymce.activeEditor.Dialogs.alert({title:"Page Title not set",message:"<p>You have not yet set the title under which this document should be published on the wiki. See the document settings on the File menu.</p>"}):(a=tinymce.activeEditor.Settings.application.get("wiki_username"),o=tinymce.activeEditor.Settings.application.get("wiki_password"),null==a||null==o?void tinymce.activeEditor.Dialogs.alert({title:"No Wiki Credentials",message:"<p>You have not given your wiki username and password to the application settings.  See the application settings on the File menu.</p>"}):(n=function(e,t){var o,n;return t?void tinymce.activeEditor.Dialogs.alert({title:"Posting Error",message:"<p>Error when posting to the wiki:</p> <p>"+t+"</p>"}):(o=/^[^/]+\/\/[^/]+\//.exec(window.location.href),n=window.location.href.slice(0,o[0].length)+"wiki/index.php?title="+encodeURIComponent(i),tinymce.activeEditor.Dialogs.alert({title:"Document Posted",message:"<p>Posting succeeded.</p> <p><a href='"+n+"' target='_blank'>Visit posted page.</a></p>"}))},t=function(e,t){var o;return t?void tinymce.activeEditor.Dialogs.alert({title:"Wiki Login Error",message:"<p>Error when logging into the wiki:</p> <p>"+t+"</p>"}):(o=tinymce.activeEditor.MediaWiki.embedMetadata(tinymce.activeEditor.getContent(),tinymce.activeEditor.Settings.document.metadata),tinymce.activeEditor.MediaWiki.exportPage(i,o,n))},tinymce.activeEditor.MediaWiki.login(a,o,t)))}},window.afterEditorReadyArray.push(function(e){var i,o,n,a,r,c,d,s;if(e.MediaWiki.setIndexPage("/wiki/index.php"),e.MediaWiki.setAPIPage("/wiki/api.php"),(a=/\?wikipage=(.*)/.exec(window.location.search))&&e.MediaWiki.importPage(decodeURIComponent(a[1],function(t,i){return null!=i?e.LoadSave.loadMetaData(i):void 0})),i="auto-load",(a=/\?autoload=(.*)/.exec(window.location.search))&&(i=decodeURIComponent(a[1])),c=localStorage.getItem(i))try{d=JSON.parse(c),r=d[0],o=d[1],setTimeout(function(){var n,a;return localStorage.removeItem(i),a=/^\s*<shorthand>(.*)<\/shorthand>\s*$/,o=o.replace(/\n|\cJ/g," "),(n=a.exec(o))?t(o):tinymce.activeEditor.setContent(o),e.LoadSave.loadMetaData(r)},100)}catch(l){}return(a=/\?document([0-9]*)=(.*)/.exec(window.location.search))?(n=decodeURIComponent(a[2]),s=extractMetadata(n),r=s.metadata,o=s.document,localStorage.setItem("auto-load"+a[1],JSON.stringify([r,o])),window.location.href=window.location.href.split("?")[0]+"?autoload=auto-load"+a[1]):void 0}),e=function(){var e;return e=/nathancarter\.github\.io/.test(window.location.href),e&&tinymce.activeEditor.Dialogs.alert({title:"Not Available Here",message:"<p>That functionality requires MediaWiki to be running on the server from which you're accessing this web app.</p> <p>On GitHub, we cannot run a MediaWiki server, so the functionality is disabled.</p> <p>The menu items remain for use in developer testing, as we prepare for a dedicated server that will have MediaWiki and the ability to publish documents to that wiki with a single click, or edit them in Lurch with a single click.</p> <p>Try back soon!</p>"}),e},t=function(e){var t,o,n,a,r,c,d,s,l,p,u,m,g,h,v,w,f,y,k,E,M,b,x;for(a=tinymce.activeEditor.getDoc(),n=a.createElement("div"),n.innerHTML=e,g={},l={},o={},s={},h=0,v=function(e){var t,i,n,a,r,c,d;return"E"===e.tagName&&(r=h++),c=function(){var i,o,n,a;for(n=e.childNodes,a=[],i=0,o=n.length;o>i;i++)t=n[i],a.push(v(t));return a}(),"E"===e.tagName?(e.hasAttribute("n")&&(a=e.getAttribute("n"),g[a]=r,l[r]=a),e.hasAttribute("at")&&(s[r]=e.getAttribute("at")),e.hasAttribute("to")&&(o[r]=function(){var t,i,o,a;for(o=e.getAttribute("to").split(","),a=[],t=0,i=o.length;i>t;t++)n=o[t],a.push(Number(n));return a}()),grouperHTML("expression","open",r,!1,"")+c.join("")+grouperHTML("expression","close",r,!1,"")):(i=e.cloneNode(!1),i.innerHTML=c.join(""),null!=(d=i.outerHTML)?d:i.textContent)},tinymce.activeEditor.setContent(v(n)),tinymce.activeEditor.Groups.scanDocument(),d=E=h;0>=h?0>=E:E>=0;d=0>=h?++E:--E)if(d in s){if(!(c=tinymce.activeEditor.Groups[d]))continue;if(!c.parent){c.set("key",s[d]);continue}p=OM.encodeAsIdentifier(s[d]),u={m:c.completeForm().encode(),v:LZString.compress(c.groupAsHTML(!1))},(t=c.parent.get(p))&&(r=OM.decode(t.m),(null!=(x=r.children[0])?x.equals(Group.prototype.listSymbol):void 0)?t.m=OM.app.apply(OM,[r.children[0],OM.decode(u.m)].concat(i.call(r.children[1]))).encode():t.m=OM.app(Group.prototype.listSymbol,r,OM.decode(u.m)).encode(),t.v=u.v+t.v,u=t),c.parent.set(p,u),c.remove()}for(f in o)if(k=o[f],w=tinymce.activeEditor.Groups[f])for(M=0,b=k.length;b>M;M++)m=k[M],(y=tinymce.activeEditor.Groups[g[m]])&&w.connect(y);return tinymce.activeEditor.undoManager.clear()}}).call(this);
//# sourceMappingURL=main-app-import-export-solo.min.js.map