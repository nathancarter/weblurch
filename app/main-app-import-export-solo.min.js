(function(){var e,t,i=[].slice;window.groupMenuItems.wikiimport={text:"Import from wiki...",context:"file",onclick:function(){var t;if(!e()&&(t=prompt("Give the name of the page to import (case sensitive)","Main Page"),null!==t))return tinymce.activeEditor.MediaWiki.importPage(t,function(e,t){return null!=t?tinymce.activeEditor.Settings.document.metadata=t:void 0})}},window.groupMenuItems.wikiexport={text:"Export to wiki",context:"file",onclick:function(){var t,i,o,n,a;if(!e())return i=tinymce.activeEditor.Settings.document.get("wiki_title"),null==i?void tinymce.activeEditor.Dialogs.alert({title:"Page Title not set",message:"<p>You have not yet set the title under which this document should be published on the wiki. See the document settings on the File menu.</p>"}):(a=tinymce.activeEditor.Settings.application.get("wiki_username"),o=tinymce.activeEditor.Settings.application.get("wiki_password"),null==a||null==o?void tinymce.activeEditor.Dialogs.alert({title:"No Wiki Credentials",message:"<p>You have not given your wiki username and password to the application settings.  See the application settings on the File menu.</p>"}):(n=function(e,t){var o,n;return t?void tinymce.activeEditor.Dialogs.alert({title:"Posting Error",message:"<p>Error when posting to the wiki:</p> <p>"+t+"</p>"}):(o=/^[^\/]+\/\/[^\/]+\//.exec(window.location.href),n=window.location.href.slice(0,o[0].length)+"wiki/index.php?title="+encodeURIComponent(i),tinymce.activeEditor.Dialogs.alert({title:"Document Posted",message:"<p>Posting succeeded.</p> <p><a href='"+n+"' target='_blank'>Visit posted page.</a></p>"}))},t=function(e,t){var o;return t?void tinymce.activeEditor.Dialogs.alert({title:"Wiki Login Error",message:"<p>Error when logging into the wiki:</p> <p>"+t+"</p>"}):(o=tinymce.activeEditor.MediaWiki.embedMetadata(tinymce.activeEditor.getContent(),tinymce.activeEditor.Settings.document.metadata),tinymce.activeEditor.MediaWiki.exportPage(i,o,n))},tinymce.activeEditor.MediaWiki.login(a,o,t)))}},window.afterEditorReadyArray.push(function(e){var i,o,n,a,r,d,c,l,s,u;if(c=window.location.search,d=null,(a=/^\?post-after-autoload=(.*)/.exec(c))&&(d=function(){return e.LoadSave.waitForMetaData(function(e){return window.parent.postMessage({type:"metadata loaded",metadata:e},"*")})},c="?autoload="+a[1]),e.MediaWiki.setIndexPage("/wiki/index.php"),e.MediaWiki.setAPIPage("/wiki/api.php"),(a=/\?wikipage=(.*)/.exec(c))&&e.MediaWiki.importPage(decodeURIComponent(a[1],function(t,i){return null!=i?e.LoadSave.loadMetaData(i):void 0})),i="auto-load",(a=/\?autoload=(.*)/.exec(c))&&(i=decodeURIComponent(a[1])),l=localStorage.getItem(i))try{s=JSON.parse(l),r=s[0],o=s[1],setTimeout(function(){var n,a,c;return localStorage.removeItem(i),c=/^\s*<shorthand>(.*)<\/shorthand>\s*$/,o=o.replace(/\n|\cJ/g," "),(a=c.exec(o))?(n="dependency-for-"+i,t(e,o,function(t){return t&&(null==r&&(r={}),r.dependencies=[{address:n,data:t.exports,date:new Date}]),e.LoadSave.loadMetaData(r),"function"==typeof d?d():void 0},n)):(e.setContent(o),e.LoadSave.loadMetaData(r),"function"==typeof d?d():void 0)},100)}catch(p){}return(a=/\?document([0-9]*)=(.*)/.exec(c))?(n=decodeURIComponent(a[2]),u=extractMetadata(n),r=u.metadata,o=u.document,localStorage.setItem("auto-load"+a[1],JSON.stringify([r,o])),window.location.href=window.location.href.split("?")[0]+"?autoload=auto-load"+a[1]):void 0}),e=function(){var e;return e=/nathancarter\.github\.io/.test(window.location.href),e&&tinymce.activeEditor.Dialogs.alert({title:"Not Available Here",message:"<p>That functionality requires MediaWiki to be running on the server from which you're accessing this web app.</p> <p>On GitHub, we cannot run a MediaWiki server, so the functionality is disabled.</p> <p>The menu items remain for use in developer testing, as we prepare for a dedicated server that will have MediaWiki and the ability to publish documents to that wiki with a single click, or edit them in Lurch with a single click.</p> <p>Try back soon!</p>"}),e},t=function(e,t,o,n){var a,r,d,c,l,s,u,p,m,g,h,v,f,w,y,k,M,E,b,x,S,D,L,I,N,A;for(l=e.getDoc(),c=l.createElement("div"),c.innerHTML=t,y={},h={},r={},g={},k=0,d=null,E=function(e){var t,i,o,n,a,c,l;return"DEPENDENCY"===e.tagName?(d="<shorthand>"+e.innerHTML+"</shorthand>",""):("E"===e.tagName&&(a=k++),c=function(){var i,o,n,a;for(n=e.childNodes,a=[],i=0,o=n.length;o>i;i++)t=n[i],a.push(E(t));return a}(),"E"===e.tagName?(e.hasAttribute("n")&&(n=e.getAttribute("n"),y[n]=a,h[a]=n),e.hasAttribute("at")&&(g[a]=e.getAttribute("at")),e.hasAttribute("to")&&(r[a]=function(){var t,i,n,a;for(n=e.getAttribute("to").split(","),a=[],t=0,i=n.length;i>t;t++)o=n[t],a.push(Number(o));return a}()),grouperHTML("expression","open",a,!1,"")+c.join("")+grouperHTML("expression","close",a,!1,"")):(i=e.cloneNode(!1),i.innerHTML=c.join(""),null!=(l=i.outerHTML)?l:i.textContent))},e.setContent(E(c)),e.Groups.scanDocument(),m=L=k;0>=k?0>=L:L>=0;m=0>=k?++L:--L)if(m in g){if(!(u=e.Groups[m]))continue;if(!u.parent){u.set("key",g[m]),u.set("keyposition","arrow");continue}v=OM.encodeAsIdentifier(g[m]),f={m:u.completeForm().encode(),v:LZString.compress(u.groupAsHTML(!1))},(a=u.parent.get(v))&&(s=OM.decode(a.m),(null!=(A=s.children[0])?A.equals(Group.prototype.listSymbol):void 0)?a.m=OM.app.apply(OM,[s.children[0],OM.decode(f.m)].concat(i.call(s.children[1]))).encode():a.m=OM.app(Group.prototype.listSymbol,s,OM.decode(f.m)).encode(),a.v=f.v+a.v,f=a),u.parent.set(v,f),u.remove()}for(x in r)if(D=r[x],b=e.Groups[x])for(I=0,N=D.length;N>I;I++)w=D[I],(S=e.Groups[y[w]])&&b.connect(S);return e.undoManager.clear(),null!=o?null===d?o(null):(localStorage.setItem(n,JSON.stringify([null,d])),M=document.createElement("iframe"),p=function(e){return"metadata loaded"===e.data.type?(window.removeEventListener("message",p),o(e.data.metadata),document.body.removeChild(M)):void 0},window.addEventListener("message",p,!1),M.setAttribute("src",window.location.href.split("?")[0]+"?post-after-autoload="+n),M.style.display="none",document.body.appendChild(M)):void 0}}).call(this);
//# sourceMappingURL=main-app-import-export-solo.min.js.map