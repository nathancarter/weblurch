(function(){var e,t,n,o,r,i,a,c,s,u,l,f,d,h,m,p,g,y,b,v,w,T,E,x,C={}.hasOwnProperty,M=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},N=[].slice;setAppName("LeanApp"),addHelpMenuSourceCodeLink("app/lean-example-solo.litcoffee"),window.helpAboutText='<p>See the fully documented <a target="top" href="https://github.com/nathancarter/weblurch/blob/master/app/lean-example-solo.litcoffee" >source code for this demo app</a>.</p>',h=null,m=function(){return(new Date).getTime()},v=function(){return h=m()},i=function(){return"(took "+(m()-h)+" ms)"},n=window.Module={},n.TOTAL_MEMORY=67108864,n.noExitRuntime=!0,t=null,e=null,n.print=function(n){var o;if(o=null,o=/FLYCHECK_BEGIN (.*)/.exec(n))return t={type:o[1],text:[]};if(t)return(o=/([^:]+):(\d+):(\d+): (.*)/.exec(n))?(t.file=o[1],t.line=o[2],t["char"]=o[3],t.info=o[4]):/FLYCHECK_END/.test(n)?(e.push(t),t=null):t.text.push(n);throw new Error("Unexpected output from Lean: "+n)},n.preRun=[function(){}],g=window.runLeanOn=function(t){return n.lean_init(!1),n.lean_import_module("standard"),FS.writeFile("test.lean",t,{encoding:"utf8"}),e=[],n.lean_process_file("test.lean"),e},x=!1,b=function(e,t,n){return e.set("closeDecoration",t),e.set("closeHoverText",n)},d=function(e,t,n){var o,r;return o=t?"green":"red",r=t?"&#10003;":"&#10006;",b(e,"<font color='"+o+"'>"+r+"</font>",n)},c=function(e){return e.clear("closeDecoration"),e.clear("closeHoverText")},u=function(e){return"undefined"!=typeof e.get("closeDecoration")},a=function(){var e,t,n,o,r;if(!x){for(x=!0,e=tinymce.activeEditor.Groups,r=e.ids(),n=0,o=r.length;o>n;n++)t=r[n],c(e[t]);return x=!1}},T=window.validate=function(){var e,t,n,o,r,i,a,c,f,h,m,p,y,v,w,T,E,M,N,L,R,k,I,O,A,H,G,_,j,S,$,D,F,q;if(i=tinymce.activeEditor.Groups,!x){for(x=!0,_=i.ids(),M=0,k=_.length;k>M;M++)a=_[M],"term"===i[a].typeName()&&"term"===(null!=(j=i[a].parent)?j.typeName():void 0)&&d(i[a],!1,"A term group cannot be inside another term group.");for(y={},S=(m=s()).lines,c=N=0,I=S.length;I>N;c=++N)p=S[c],(v=/[ ]--[ ](\d+)$/.exec(p))&&(y[c+1]=parseInt(v[1]));for(h=-1,t=m.lines.join("\n").replace(String.fromCharCode(160),String.fromCharCode(32)),$=g(t),L=0,O=$.length;O>L;L++)w=$[L],a=y[w.line],(f=/error:/.test(w.info))&&(h=a),r="Lean reported:\n\n"+w.info,w.text.length&&(r+="\n"+w.text.join("\n")),e=parseInt(w["char"]),e=e>0?(n=m.lines[w.line-1],"\n\ncharacter #"+(e+1)+" in this code: \n"+/^(.*) -- \d+$/.exec(n)[1]):"",d(i[a],!f,r+e);for(D=i.ids(),R=0,A=D.length;A>R&&(a=D[R],a!==h);R++)u(i[a])||d(i[a],!0,"No errors reported.");for(F=i.ids(),G=0,H=F.length;H>G;G++)if(a=F[G],"type"===(E=i[a].typeName())){if(l(i[a]))continue;T=function(){var e,t,n,r;for(n=i[a].connectionsOut(),r=[],t=0,e=n.length;e>t;t++)o=n[t],"term"===i[o[1]].typeName()&&r.push(o[1]);return r}(),0===T.length&&b(i[a],'<font color="#aaaa00"><b>&#10039;</b></font>',"This "+E+" does not modify any terms, and was thus ignored in validation.  Did you mean to connect it to a term?")}q=m.errors;for(a in q)C.call(q,a)&&(w=q[a],d(i[a],!1,w));return x=!1}},E=null,window.groupToolbarButtons.validate={text:"Run Lean",tooltip:"Run Lean on this document",onclick:function(){return E.text("Running..."),E.disabled(!0),setTimeout(function(){return T(),E.disabled(!1),E.text("Run Lean")},0)},onPostRender:function(){return E=this}},f={check:"check (TERM)",eval:"eval (TERM)",print:'print "TERM"',"import":"import TERM",open:"open TERM",constant:"constant TERM",variable:"variable TERM",definition:"definition TERM",theorem:"theorem TERM",example:"example TERM"},window.groupTypes=[{name:"term",text:"Lean Term",tooltip:"Make the selection a Lean term",color:"#666666",imageHTML:'<font color="#666666"><b>[ ]</b></font>',openImageHTML:'<font color="#666666"><b>[</b></font>',closeImageHTML:'<font color="#666666"><b>]</b></font>',contentsChanged:a,tagContents:function(e){var t;return(t=e.get("leanCommand"))?"Command: "+t:null},contextMenuItems:function(e){return[{text:"Edit command...",onclick:function(){var t,n;return t=prompt("Enter the Lean command to use on this code (or leave blank for none).\n \nValid options include:\n"+Object.keys(f).join(" "),null!=(n=e.get("leanCommand"))?n:""),null!==t?""===t?e.clear("leanCommand"):t in f?e.set("leanCommand",t):alert("That was not one of the choices.  No change has been made to your document."):void 0}}]},connectionRequest:function(e,t){var n,o;if("term"===t.typeName()||"body"===t.typeName())return o=t.id(),M.call(function(){var t,o,r,i;for(r=e.connectionsOut(),i=[],t=0,o=r.length;o>t;t++)n=r[t],i.push(n[1]);return i}(),o)>=0?tinymce.activeEditor.undoManager.transact(function(){return e.disconnect(t)}):p(t.id(),e.id())?alert("That would create a cycle of arrows, which is not permitted."):tinymce.activeEditor.undoManager.transact(function(){return e.connect(t)})},connections:function(e){var t,n,o;return n=e.connectionsOut(),t=e.connectionsIn(),N.call(n).concat(N.call(t),N.call(function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(o[1]);return r}()),N.call(function(){var e,n,r;for(r=[],e=0,n=t.length;n>e;e++)o=t[e],r.push(o[0]);return r}()))}}],w=window.termGroupToCode=function(e){var t,n,r,i,a,c,s,u,l,h,m,p,g,y,b,v,T,E,x,C;if(h=tinymce.activeEditor.Groups,e.children.length>0)throw Error("Invalid structure: Term groups may not contain other groups");for(b=e.contentAsText().trim(),r=function(){var t,n,o,r;for(o=e.connectionsOut(),r=[],t=0,n=o.length;n>t;t++)u=o[t],r.push(u[1]);return r}(),n=function(){var e,n,i;for(i=[],e=0,n=r.length;n>e;e++){t=r[e];try{i.push("term"===h[t].typeName()?w(h[t]):o(h[t]))}catch(a){throw l=a,d(h[t],!1,l.message),Error("A term to which this term points (directly or indirectly) contains an error, and thus this term's meaning cannot be determined.")}}return i}(),r.length>0&&(b="( -- "+e.id()+"\n "+b+" -- "+e.id()+"\n "+n.join("\n")+"\n )"),p=[],a=[],i=[],x=e.connectionsIn(),T=0,E=x.length;E>T;T++)u=x[T],y=h[u[0]],"type"===y.typeName()?(v=y.contentAsText().trim(),M.call(a,v)<0&&a.push(v)):"body"===y.typeName()&&(C=y.id(),M.call(i,C)<0)?i.push(y.id()):"term"===y.typeName()&&p.push(y);if(a.length>1)throw Error("Invalid structure: Two different types are assigned to this term ("+a.join(", ")+")");if(i.length>1)throw Error("Invalid structure: Two bodies are assigned to this term.");if(p.length>0){if(a.length>0)throw Error("Invalid structure: A subterm of another term cannot have a type assigned.");if(i.length>0)throw Error("Invalid structure: A subterm of another term cannot have a body assigned.")}if(a.length>0&&(v=a[0],b=(m=/^\s*check\s+(.*)$/.exec(b))?"check ("+m[1]+" : "+v+")":(m=/^\s*check\s+\((.*)\)\s*$/.exec(b))?"check ("+m[1]+" : "+v+")":(m=/^(.*):=(.*)$/.exec(b))?""+m[1]+" : "+v+" := "+m[2]:""+b+" : "+v),(c=e.get("leanCommand"))&&(b=f[c].replace("TERM",b)),g=""+b+" -- "+e.id(),i.length>0){if(s=["theorem","definition","example"],M.call(s,c)<0)throw Error("Terms may only be assigned bodies if they embed one of these commands: "+s.join(", ")+".");g+="\n:= "+o(h[i[0]])}return g},s=window.documentToCode=function(){var e,t,n,o,i,a,c;for(o={lines:[],errors:{}},c=tinymce.activeEditor.Groups.topLevel,i=0,a=c.length;a>i;i++)if(t=c[i],"body"===t.typeName()&&r(t))n=y(t),o.lines=o.lines.concat(n.split("\n"));else if("term"===t.typeName()&&!l(t))try{n=w(t),o.lines=o.lines.concat(n.split("\n"))}catch(s){e=s,o.errors[t.id()]=e.message}return o},l=function(e){var t,n,o,r;for(r=e.connectionsIn(),n=0,o=r.length;o>n;n++)if(t=r[n],"term"===tinymce.activeEditor.Groups[t[0]].typeName())return!0;return!1},r=function(e){var t,n,o,r;for(r=e.connectionsOut(),n=0,o=r.length;o>n;n++)if(t=r[n],"term"===tinymce.activeEditor.Groups[t[1]].typeName())return!1;return!0},p=function(e,t){var n,o,r,i,a;for(o=tinymce.activeEditor.Groups,a=[],i=[e];i.length>0;){if((r=i.shift())===t)return!0;M.call(a,r)>=0||(a.push(r),i=i.concat(function(){var e,t,i,a;for(i=o[r].connectionsOut(),a=[],e=0,t=i.length;t>e;e++)n=i[e],a.push(n[1]);return a}()))}return!1},window.groupTypes.push({name:"type",text:"Lean Type",tooltip:"Make the selection a Lean type",color:"#66bb66",imageHTML:'<font color="#66bb66"><b>[ ]</b></font>',openImageHTML:'<font color="#66bb66"><b>[</b></font>',closeImageHTML:'<font color="#66bb66"><b>]</b></font>',contentsChanged:a,connectionRequest:function(e,t){var n,o;if("term"===t.typeName())return o=t.id(),tinymce.activeEditor.undoManager.transact(M.call(function(){var t,o,r,i;for(r=e.connectionsOut(),i=[],t=0,o=r.length;o>t;t++)n=r[t],i.push(n[1]);return i}(),o)>=0?function(){return e.disconnect(t)}:function(){return e.connect(t)})}}),window.useGroupConnectionsUI=!0,window.groupTypes.push({name:"body",text:"Body of a Lean definition or section",tooltip:"Make the selection a body",color:"#6666bb",imageHTML:'<font color="#6666bb"><b>[ ]</b></font>',openImageHTML:'<font color="#6666bb"><b>[</b></font>',closeImageHTML:'<font color="#6666bb"><b>]</b></font>',contentsChanged:a,contextMenuItems:function(e){var t,n;return n=function(){var t;return t=prompt("Enter the identifier to use as the name of the namespace.",e.get("namespace")),null!==t?/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t)?e.set("namespace",t):alert("That was a valid Lean identifier.  No change has been made to your document."):void 0},r(e)?(t=e.get("namespace"))?[{text:"Make this a section",onclick:function(){return e.clear("namespace")}},{text:"Rename this namespace...",onclick:n}]:[{text:"Make this a namespace...",onclick:n}]:[]},tagContents:function(e){var t;return r(e)?(t=e.get("namespace"))?"Namespace: "+t:"Section":""},connectionRequest:function(e,t){var n,o;if("term"===t.typeName())return o=t.id(),M.call(function(){var t,o,r,i;for(r=e.connectionsOut(),i=[],t=0,o=r.length;o>t;t++)n=r[t],i.push(n[1]);return i}(),o)>=0?tinymce.activeEditor.undoManager.transact(function(){return e.disconnect(t)}):p(t.id(),e.id())?alert("That would create a cycle of arrows, which is not permitted."):tinymce.activeEditor.undoManager.transact(function(){return e.connect(t)})}}),o=window.bodyGroupToCode=function(e){var t,n,r,i,a,c,s,u,f,d,h,m,p,g;if(n=function(){var n,o,r,i;for(r=e.children,i=[],n=0,o=r.length;o>n;n++)t=r[n],("term"===t.typeName()||"body"===t.typeName())&&i.push(t);return i}(),0===n.length)return""+e.contentAsText()+" -- "+e.id();for(p=n.slice(0,-1),i=u=0,h=p.length;h>u;i=++u)if(t=p[i],"body"===t.typeName())throw Error("A body group can only contain other body groups as its final child.  This one has another body group as child #"+(i+1)+".");for(r=tinymce.activeEditor.Groups,s=function(e){var n,o,i,a,c,u,l,f;for(u=e.connectionsIn(),o=0,a=u.length;a>o;o++)if(n=u[o],"body"===r[n[0]].typeName())throw Error("One of the groups inside this body has a body group connected to it.  That type of nesting is not permitted.");for(l=e.children,f=[],i=0,c=l.length;c>i;i++)t=l[i],f.push(s(t));return f},s(e),c=[],f=0,m=n.length;m>f;f++)if(t=n[f],"term"===t.typeName()){if(l(t))continue;c.push(w(t))}else c.push(o(t));for(i=d=0,g=c.length-1;g>=0?g>d:d>g;i=g>=0?++d:--d)a=/^(.*) -- (\d+)$/.exec(c[i]),c[i]="assume "+a[1]+", -- "+a[2];return c.join("\n")},y=window.sectionGroupToCode=function(e){var t,n,o,i,a,c,s,u,f,h;for(i=e.get("namespace"),s=i?"namespace":"section",c=null!=i?i:e.id(),o=("namespace"===s?"":s)+c,a=[],h=e.children,u=0,f=h.length;f>u;u++)if(t=h[u],!l(t))try{if("term"===t.typeName())a.push(w(t));else if("body"===t.typeName()){if(!r(t))continue;a.push(y(t))}}catch(m){n=m,d(t,!1,n.message)}return""+s+" "+o+" -- "+e.id()+"\n "+a.join("\n")+"\n end "+o+" -- "+e.id()},window.afterEditorReady=function(e){return e.on("KeyUp",function(t){var n,o,r,i,a,c,s,u,l,f,d,h,m;if(c=[33,34,35,36,37,38,39,40],a=[16,17,18,91],h=t.keyCode,!(M.call(c,h)>=0||(m=t.keyCode,M.call(a,m)>=0))&&(u=e.selection.getRng(),u.startContainer===u.endContainer&&u.startContainer instanceof e.getWin().Text)){if(r=u.startContainer.textContent,i=r[u.startOffset-1]," "!==i&&"\\"!==i&&i!==String.fromCharCode(160))return;if(o=r.substr(0,u.startOffset-1),n=r.substring(u.startOffset-1),f=o.lastIndexOf("\\"),-1===f)return;if(d=o.substr(f+1),o=o.substr(0,f),!(l=corrections[d]))return;return s=u.startOffset-d.length-1+l.length,"\\"!==i&&(n=n.substr(1),s--),u.startContainer.textContent=o+l+n,u.setStart(u.startContainer,s),u.setEnd(u.startContainer,s),e.selection.setRng(u)}})}}).call(this);
//# sourceMappingURL=lean-example-solo.min.js.map