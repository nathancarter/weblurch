(function(){var e,l,t,i,n,o,d,r,a,s,f,u,c,p,v=[].indexOf||function(e){for(var l=0,t=this.length;t>l;l++)if(l in this&&this[l]===e)return l;return-1};window.onmessage=function(e){var l;return e.data instanceof Array?(l=e.data.shift(),"function"!=typeof window[l]?console.log("Cannot call non-function:",l):window[l].apply(null,e.data)):console.log("Invalid message from page:",e.data)},c=function(e){return window.top.postMessage(e,"*")},o=new FileSystem("demo"),window.setFileSystemName=function(e){return o=new FileSystem(e),updateFileBrowser()},n=null,p=["manage files","open file","save file","open folder","save in folder"],window.setFileBrowserMode=function(e){return v.call(p,e)>=0&&(n=e),updateFileBrowser()},window.fileBeingMoved={},window.fileToBeOpened=null,window.selectFile=function(e){return window.fileToBeOpened=e,c(["selectedFile",e]),updateFileBrowser()},t=function(e){return o.cd(e),c(["changedFolder",o.getCwd()]),selectFile(null)},r=!1,window.setDialogImitation=function(e){return null==e&&(e=!0),r=!!e,updateFileBrowser()},window.buttonClicked=function(e){var l,t,i,n;return"New folder"===e?(t=prompt("Enter name of new folder","My Folder"),void(o.mkdir(t)?updateFileBrowser():alert("That folder name is already in use."))):(l=[],"Save"===e&&(i=o.getCwd(),i.slice(-1)!==FileSystem.prototype.pathSeparator&&(i+=FileSystem.prototype.pathSeparator),l.push(i+saveFileName.value),fileBeingMoved.name&&(l.unshift(fileBeingMoved.full),fileBeingMoved.copy?(n=o.cp(fileBeingMoved.full,i+saveFileName.value),e=n?"Copied":"Copy failed"):(n=o.mv(fileBeingMoved.full,i+saveFileName.value),e=n?"Moved":"Move failed"))),"Save here"===e&&l.push(o.getCwd()),"Open"===e&&(i=o.getCwd(),i.slice(-1)!==FileSystem.prototype.pathSeparator&&(i+=FileSystem.prototype.pathSeparator),l.push(i+fileToBeOpened)),"Open this folder"===e&&(l.push(o.getCwd()),e="Open folder"),c(["buttonClicked",e].concat(l)),window.fileBeingMoved={},selectFile(null),setFileBrowserMode("manage files"))},window.onload=u=function(){return setFileBrowserMode("manage files"),t(".")},l=function(e){return confirm("Are you sure you want to permantely delete "+e+"?")?(o.rm(e),updateFileBrowser()):void 0},window.updateFileBrowser=function(){var i,u,c,p,v,g,F,w,m,h,B,y,M,b,S,C,N,x,k,O,T,E,D,L,I,P,K,j,A,G,z;for(B={navigateFolders:!0,deleteFolders:!0,deleteFiles:!0,createFolders:!0,fileNameTextBox:!1,filesDisabled:!1,moveFiles:!0,moveFolders:!0,copyFiles:!0,extensionFilter:!1,selectFile:!1},E=n?n[0].toUpperCase()+n.slice(1):"",v=[],"manage files"===n?v=["New folder","Done"]:"save file"===n?(B.deleteFolders=B.deleteFiles=B.moveFiles=B.moveFolders=B.copyFiles=!1,B.fileNameTextBox=!0,E="Save as...",v=["Cancel","Save"],r&&v.unshift("New folder")):"save in folder"===n?(B.deleteFolders=B.deleteFiles=B.moveFiles=B.moveFolders=B.copyFiles=!1,B.filesDisabled=!0,E="Save in...",v=["New folder","Cancel","Save here"]):"open file"===n?(B.deleteFolders=B.deleteFiles=B.moveFiles=B.moveFolders=B.copyFiles=!1,B.extensionFilter=B.selectFile=!0,v=["Cancel","Open"]):"open folder"===n&&(B.deleteFolders=B.deleteFiles=B.moveFiles=B.moveFolders=B.copyFiles=!1,B.filesDisabled=!0,v=["Cancel","Open this folder"]),w=[],o.getCwd()!==FileSystem.prototype.pathSeparator&&(i=d("up-arrow"),u="Parent folder",B.navigateFolders&&(p=function(){return t("..")},i=a(i,"Go up to parent folder",p),u=a(u,"Go up to parent folder",p)),w.push(f(i,u))),G=o.ls(".","folders"),L=0,K=G.length;K>L;L++)b=G[L],i=d("folder"),u=b,B.navigateFolders&&!function(e){return p=function(){return t(e)},i=a(i,"Enter folder "+e,p),u=a(u,"Enter folder "+e,p)}(b),c="",B.deleteFolders&&!function(e){return c+=a(d("delete"),"Delete folder "+e,function(){return l(e)})}(b),B.moveFolders&&!function(e){return c+=a(d("move"),"Move folder "+e,function(){var l;return window.fileBeingMoved={name:e},fileBeingMoved.path=o.getCwd(),fileBeingMoved.full=fileBeingMoved.path,l=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==l&&(fileBeingMoved.full+=l),fileBeingMoved.full+=e,fileBeingMoved.copy=!1,n="save file",updateFileBrowser()})}(b),w.push(f(i,u,c));for(M="undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.options["undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.selectedIndex:void 0].value:void 0,M="*.*"===M?null:null!=M?M.slice(1):void 0,z=o.ls(".","files"),I=0,j=z.length;j>I;I++)y=z[I],M&&y.slice(-M.length)!==M||(i=d("text-file"),u=y,B.filesDisabled?u="<font color='#888888'>"+u+"</font>":B.selectFile&&!function(e){return p=function(){return selectFile(e)},i=a(i,"Open "+e,p),u=a(u,"Open "+e,p)}(y),B.fileNameTextBox&&!function(e){return p=function(){return saveFileName.value=e,saveBoxKeyPressed()},i=a(i,"Save as "+e,p),u=a(u,"Save as "+e,p)}(y),c="",B.deleteFiles&&!function(e){return c+=a(d("delete"),"Delete file "+e,function(){return l(e)})}(y),B.moveFiles&&!function(e){return c+=a(d("move"),"Move file "+e,function(){var l;return window.fileBeingMoved={name:e},fileBeingMoved.path=o.getCwd(),fileBeingMoved.full=fileBeingMoved.path,l=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==l&&(fileBeingMoved.full+=l),fileBeingMoved.full+=e,fileBeingMoved.copy=!1,n="save file",updateFileBrowser()})}(y),B.copyFiles&&!function(e){return c+=a(d("copy"),"Copy file "+e,function(){var l;return window.fileBeingMoved={name:e},fileBeingMoved.path=o.getCwd(),fileBeingMoved.full=fileBeingMoved.path,l=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==l&&(fileBeingMoved.full+=l),fileBeingMoved.full+=e,fileBeingMoved.copy=!0,n="save file",updateFileBrowser()})}(y),m=f(i,u,c),fileToBeOpened===y&&(m="SELECT"+m),w.push(m));for(0===w.length&&w.push("(empty filesystem)"),C=s(w),D=O="",B.fileNameTextBox&&(O+="File name: <input id='saveFileName' type='text' size=40 onkeyup='saveBoxKeyPressed(event);'/>"),B.extensionFilter&&(h=function(){var l,t,i,n;for(i=e(),n=[],l=0,t=i.length;t>l;l++)F=i[l],n.push("<option>"+F+"</option>");return n}(),O+="File type: <select id='fileFilter' onchange='updateFileBrowser();'> "+h.join("\n")+" </select>"),S=P=0,A=v.length;A>P;S=++P)T=v[S],g="","Open"!==T||fileToBeOpened||(g="disabled=true"),v[S]="<input type='button' value='  "+T+"  ' id='statusBarButton"+T+"' "+g+" onclick='buttonClicked(\""+T+"\");'/>";return v=v.join(" "),r?(k=o.getCwd(),k===FileSystem.prototype.pathSeparator&&(k+=" (top level)"),D="<table border=1 cellpadding=5 cellspacing=0 width=100% height=100%> <tr height=1%> <td bgcolor=#cccccc> <table border=0 cellpadding=0 cellspacing=0 width=100%> <tr> <td align=left width=33%> <b>"+E+"</b> </td> <td align=center width=34%> Folder: "+k+" </td> <td align=right width=33%> "+d("close")+" </td> </tr> </table> </td> </tr> <tr> <td bgcolor=#fafafa valign=top>",O="   </td> </tr> <tr height=1%> <td bgcolor=#cccccc> <table border=0 cellpadding=0 cellspacing=0 width=100%> <tr> <td align=left width=50%> "+O+" </td> <td align=right width=50%> "+v+" </td> </tr> </table> </td> </tr> </table>"):(window.fileBeingMoved.name&&(O+=" &nbsp; "+v),O="<div style='position: absolute; bottom: 0; width: 90%; margin-bottom: 5px;'> <center>"+O+"</center> </div>"),x=("undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.value:void 0)||("undefined"!=typeof fileBeingMoved&&null!==fileBeingMoved?fileBeingMoved.name:void 0),N="undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.selectedIndex:void 0,document.body.innerHTML=D+C+O,x&&"undefined"!=typeof saveFileName&&null!==saveFileName&&(saveFileName.value=x),N&&"undefined"!=typeof fileFilter&&null!==fileFilter&&(fileFilter.selectedIndex=N),saveBoxKeyPressed(),"undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.focus():void 0},window.saveBoxKeyPressed=function(e){var l;return l="undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.value:void 0,"undefined"!=typeof statusBarButtonSave&&null!==statusBarButtonSave&&(statusBarButtonSave.disabled=!l),"string"==typeof l&&c(["saveFileNameChanged",l]),13===(null!=e?e.keyCode:void 0)?buttonClicked("Save"):27===(null!=e?e.keyCode:void 0)?buttonClicked("Cancel"):void 0},s=function(e){var l,t,i,n,o,d,r,a;for(d="<table border=0 width=100% cellspacing=5 cellpadding=5>",l=Math.ceil(e.length/2),t=a=0;l>=0?l>a:a>l;t=l>=0?++a:--a)n=e[t],i="bgcolor=#e8e8e8","SELECT"===n.slice(0,6)&&(i="bgcolor=#ddddff",n=n.slice(6)),r=e[t+l],o="bgcolor=#e8e8e8",r?"SELECT"===r.slice(0,6)&&(o="bgcolor=#ddddff",r=r.slice(6)):o="",d+="<tr> <td width=50% "+i+">"+n+"</td> <td width=50% "+o+">"+(r||"")+"</td> </tr>";return d+"</table>"},window.actionLinks=[],i=function(){var e;return e=[]},a=function(e,l,t){var i;return i=actionLinks.length,actionLinks.push(t),"<a href='javascript:void(0);' title='"+l+"' onclick='actionLinks["+i+"]();'>"+e+"</a>"},d=function(e){return"<img src='"+e+".png'>"},f=function(e,l,t){return null==t&&(t=""),"<table border=0 cellpadding=0 cellspacing=0 width=100%><tr> <td width=22>"+(e||"")+"</td> <td align=left>"+l+" &nbsp; &nbsp; </td> <td align=left width=66><nobr>"+t+"</nobr></td></tr></table>"},e=function(l){var t,i,n,d,r,a,s,f,u,c,p,g,F;for(null==l&&(l=null),l||(l=new FileSystem(o.getName())),d=["*.*"],p=l.ls(".","files"),r=0,f=p.length;f>r;r++)i=p[r],t=/\.[^.]*?$/.exec(i),t&&(t="*"+t,v.call(d,t)<0&&d.push(t));for(g=l.ls(".","folders"),a=0,u=g.length;u>a;a++){for(n=g[a],l.cd(n),F=e(l),s=0,c=F.length;c>s;s++)t=F[s],v.call(d,t)<0&&d.push(t);l.cd("..")}return d.sort()}}).call(this);
//# sourceMappingURL=filedialog.min.js.map