(function(){var e,t=[].slice;e=function(t){var r,n,i;return i=tinymce.activeEditor.Groups.groupTypes.expression,n="st"===t.type?t.value:function(){var n,i,o,a;for(o=t.children,a=[],n=0,i=o.length;i>n;n++)r=o[n],a.push(e(r));return a}().join(""),i.openImageHTML+n+i.closeImageHTML},window.attributesActionForGroup=function(r){var n,i;return n=function(){return tinymce.activeEditor.windowManager.close(),i()},i=function(){var i,o,a,c,l,d,s,u,p,g,f,m,h,v,b,y,M,x,O,k,w,E,A,I,C,T,W,G,D,q,L,S,H,j;for(E="<p>Expression: "+e(r.canonicalForm())+"</p> <table border=0 cellpadding=5 cellspacing=0 width=100%>",i=function(e,t,r,n){return null==t&&(t=""),null==r&&(r=""),null==n&&(n=""),E+="<tr><td width=33% align=left>"+e+"</td> <td width=33% align=left>"+t+"</td> <td width=24% align=right>"+r+"</td> <td width=10% align=right>"+n+"</td> </tr>"},o=function(){return E+="<tr><td colspan=4><hr></td></tr>"},O={},L=r.attributeGroups(),A=0,W=L.length;W>A;A++)c=L[A],v=c.get("key"),(null!=O[v]?O[v]:O[v]=[]).push(c);for(S=r.keys(),I=0,G=S.length;G>I;I++)v=S[I],(d=OM.decodeIdentifier(v))&&null==O[d]&&(O[d]=[]);p=function(e){return OM.encodeAsIdentifier(JSON.stringify(e))},l=function(e){return JSON.parse(OM.decodeIdentifier(e))},g=function(e,t,r,n){return null==r&&(r=!0),r=r?"":'style="text-decoration: none; color: black;" ',n=n?" title='"+n+"'":"","<a href='#' id='"+p(t)+"' "+r+" "+n+" >"+e+"</a>"},u=function(e,t){return"<input type='button' id='"+p(t)+"' value='"+e+"'/>"},f=function(e,t){return"<input type='text' id='"+p(t)+"' value='"+e+"'/>"},x=function(e,t){return"<span title='"+t+"' style='color: #aaaaaa;'>"+e+"</span>"};for(v in O){for(y=O[v],(s=r.get(OM.encodeAsIdentifier(v)))&&y.push(r),w=function(e,t){return strictNodeComparator(e.open,t.open)},k=v+" "+g("&#x1f589;",["edit key",v],!1,"Edit attribute key"),H=y.sort(w),C=0,D=H.length;D>C;C++)if(a=H[C],a===r)if(m=OM.decode(s.m),"a"===m.type&&m.children[0].equals(Group.prototype.listSymbol))for(j=m.children.slice(1),h=T=0,q=j.length;q>T;h=++T)M=j[h],b=null,"st"===M.type&&(b=M.getAttribute(OM.sym("code","Lurch")),b&&"a"===b.type&&b.children[0].equals(Group.prototype.listSymbol)&&(b=b.children[b.children.length-1])),i(k,e(M)+" "+(b?g("&#x1f589;",["edit code from internal list",v,h,b.value],!1,"Edit as code"):"st"===M.type?g("&#x1f589;",["edit from internal list",v,h],!1,"Edit attribute"):x("&#x1f589;","Cannot edit -- not atomic")),"hidden "+g("&#x1f441;",["show",v],!1,"Show attribute"),g("&#10007;",["remove from internal list",v,h],!1,"Remove attribute")),k="";else b=null,"st"===m.type&&(b=m.getAttribute(OM.sym("code","Lurch")),b&&"a"===b.type&&b.children[0].equals(Group.prototype.listSymbol)&&(b=b.children[b.children.length-1])),i(k,e(m)+" "+(b?g("&#x1f589;",["edit code internal solo",v,b.value],!1,"Edit as code"):"st"===m.type?g("&#x1f589;",["edit internal solo",v],!1,"Edit attribute"):x("&#x1f589;","Cannot edit -- not atomic")),"hidden "+g("&#x1f441;",["show",v],!1,"Show attribute"),g("&#10007;",["remove internal solo",v],!1,"Remove attribute")),k="";else M=a.canonicalForm(),i(k,e(M)+" "+("st"===M.type?g("&#x1f589;",["edit external",a.id()],!1,"Edit attribute"):x("&#x1f589;","Cannot edit -- not atomic")),"visible "+g("&#x1f441;",["hide",v],!1,"Hide attribute"),g("&#10007;",["remove external",a.id()],!1,"Remove attribute")),k="";o()}return E+="</table>",0===Object.keys(O).length&&(E+="<p>The expression has no attributes.</p>",o()),E+="<center><p>"+g("<b>+</b>",["add attribute"],!1,"Add new attribute")+"</p></center>",tinymce.activeEditor.Dialogs.alert({title:"Attributes",message:E,width:600,onclick:function(e){var i,o,c,d,s,u,p,g;try{g=l(e.id),u=g[0],v=g[1],h=g[2],d=g[3]}catch(f){}if("remove from internal list"===u?(o=OM.encodeAsIdentifier(v),c=r.get(o),M=OM.decode(c.m),M=OM.app.apply(OM,[M.children[0]].concat(t.call(M.children.slice(1,h+1)),t.call(M.children.slice(h+2)))),p=decompressWrapper(c.v),p=p.split("\n"),p.splice(h,1),p=p.join("\n"),c={m:M.encode(),v:compressWrapper(p)},r.plugin.editor.undoManager.transact(function(){return r.set(o,c)}),n()):"remove internal solo"===u?(r.plugin.editor.undoManager.transact(function(){return r.clear(OM.encodeAsIdentifier(v))}),n()):"remove external"===u?(r.plugin.editor.undoManager.transact(function(){return tinymce.activeEditor.Groups[v].disconnect(r)}),n()):"show"===u?(r.unembedAttribute(v),n()):"hide"===u?(r.embedAttribute(v),n()):"edit key"===u&&tinymce.activeEditor.Dialogs.prompt({title:"Enter new key",message:'Change "'+v+'" to what?',okCallback:function(e){var t,i;return/^[a-zA-Z0-9-_]+$/.test(e)?(i=r.get(OM.encodeAsIdentifier(v)),t=r.get(OM.encodeAsIdentifier(e)),i&&t?void tinymce.activeEditor.Dialogs.alert({title:"Invalid key",message:"That key is already in use by a different hidden attribute.  You cannot rename one hidden attribute over another, because the order of combining their contents is ambiguous.  Reveal one or both attributes into the document first, to make the order clear.",width:300,height:200}):tinymce.activeEditor.undoManager.transact(function(){var t,i,o,c,l,d;for(t=r.attributeGroupsForKey(v),d=0,l=t.length;l>d;d++)a=t[d],a.set("key",e);return i=OM.encodeAsIdentifier(v),o=OM.encodeAsIdentifier(e),c=r.get(i),r.clear(i),r.set(o,c),n()})):void tinymce.activeEditor.Dialogs.alert({title:"Invalid key",message:"Keys can only contain Roman letters, decimal digits, hyphens, and underscores (no spaces or other punctuation).",width:300,height:200})}}),"edit from internal list"===u){if(o=OM.encodeAsIdentifier(v),c=r.get(o),M=OM.decode(c.m),p=decompressWrapper(c.v),p=p.split("\n"),s=/^<([^>]*)>((?:[^<]|<br>)*)<(.*)$/i.exec(p[h]),!s)return;return tinymce.activeEditor.Dialogs.prompt({title:"Enter new value",message:"Provide the new content of the atomic expression.",okCallback:function(e){return M.children[h+1].tree.v=e,e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),p[h]="<"+s[1]+">"+e+"<"+s[3],p=p.join("\n"),c={m:M.encode(),v:compressWrapper(p)},r.plugin.editor.undoManager.transact(function(){return r.set(o,c)}),n()}})}if("edit code from internal list"===u){if(o=OM.encodeAsIdentifier(v),c=r.get(o),M=OM.decode(c.m),p=decompressWrapper(c.v),p=p.split("\n"),s=/^<([^>]*)>((?:[^<]|<br>)*)<(.*)$/i.exec(p[h]),!s)return;return tinymce.activeEditor.Dialogs.codeEditor({value:M.value,language:d,okCallback:function(e){return M.children[h+1].tree.v=Group.codeToHTML(e),e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),p[h]="<"+s[1]+">"+e+"<"+s[3],p=p.join("\n"),c={m:M.encode(),v:compressWrapper(p)},r.plugin.editor.undoManager.transact(function(){return r.set(o,c)}),n()}})}if("edit internal solo"===u){if(o=OM.encodeAsIdentifier(v),c=r.get(o),M=OM.decode(c.m),p=decompressWrapper(c.v),s=/^<([^>]*)>((?:[^<]|<br>)*)<(.*)$/i.exec(p),!s)return;return tinymce.activeEditor.Dialogs.prompt({title:"Enter new value",message:"Provide the new content of the atomic expression.",okCallback:function(e){return M.tree.v=e,e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),p="<"+s[1]+">"+e+"<"+s[3],c={m:M.encode(),v:compressWrapper(p)},r.plugin.editor.undoManager.transact(function(){return r.set(o,c)}),n()}})}if("edit code internal solo"===u){if(o=OM.encodeAsIdentifier(v),c=r.get(o),M=OM.decode(c.m),p=decompressWrapper(c.v),s=/^<([^>]*)>((?:[^<]|<br>)*)<(.*)$/i.exec(p),!s)return;return tinymce.activeEditor.Dialogs.codeEditor({value:M.value,language:h,okCallback:function(e){return M.tree.v=Group.codeToHTML(e),e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),p="<"+s[1]+">"+e+"<"+s[3],c={m:M.encode(),v:compressWrapper(p)},r.plugin.editor.undoManager.transact(function(){return r.set(o,c)}),n()}})}if("edit external"===u)return tinymce.activeEditor.Dialogs.prompt({title:"Enter new value",message:"Provide the new content of the atomic expression.",okCallback:function(e){return r.plugin[v].setContentAsText(e),n()}});if("add attribute"===u){for(h=1,v=function(){return OM.encodeAsIdentifier("attribute"+h)};r.get(v());)h++;return M=OM.string("edit this"),i=function(e){var t;return t=grouperHTML("expression",e,0,!1),"open"===e&&(t=t.replace("grouper","grouper mustreconnect")),t},p=i("open")+M.value+i("close"),c={m:M.encode(),v:compressWrapper(p)},r.plugin.editor.undoManager.transact(function(){return r.set(v(),c)}),n()}}})}}}).call(this);
//# sourceMappingURL=main-app-attr-dialog-solo.min.js.map