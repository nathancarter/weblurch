(function(){var e,t=[].slice;e=function(t){var n,r,i;return i=tinymce.activeEditor.Groups.groupTypes.expression,r="st"===t.type?t.value:function(){var r,i,o,a;for(o=t.children,a=[],r=0,i=o.length;i>r;r++)n=o[r],a.push(e(n));return a}().join(""),i.openImageHTML+r+i.closeImageHTML},window.attributesActionForGroup=function(n){var r,i;return r=function(){return tinymce.activeEditor.windowManager.close(),i()},i=function(){var i,o,a,c,l,d,s,u,p,f,g,m,h,v,y,b,M,w,x,k,O,E,A,I,C,D,G,T,W,F,S,j,H;for(O="<p>Expression: "+e(n.canonicalForm())+"</p> <table border=0 cellpadding=5 cellspacing=0 width=100%>",i=function(e,t,n,r){return null==t&&(t=""),null==n&&(n=""),null==r&&(r=""),O+="<tr><td width=33% align=left>"+e+"</td> <td width=33% align=left>"+t+"</td> <td width=24% align=right>"+n+"</td> <td width=10% align=right>"+r+"</td> </tr>"},o=function(){return O+="<tr><td colspan=4><hr></td></tr>"},w={},F=n.attributeGroups(),E=0,D=F.length;D>E;E++)c=F[E],v=c.get("key"),(null!=w[v]?w[v]:w[v]=[]).push(c);for(S=n.keys(),A=0,G=S.length;G>A;A++)v=S[A],(d=OM.decodeIdentifier(v))&&null==w[d]&&(w[d]=[]);p=function(e){return OM.encodeAsIdentifier(JSON.stringify(e))},l=function(e){return JSON.parse(OM.decodeIdentifier(e))},f=function(e,t,n,r){return null==n&&(n=!0),n=n?"":'style="text-decoration: none; color: black;" ',r=r?" title='"+r+"'":"","<a href='#' id='"+p(t)+"' "+n+" "+r+" >"+e+"</a>"},u=function(e,t){return"<input type='button' id='"+p(t)+"' value='"+e+"'/>"},g=function(e,t){return"<input type='text' id='"+p(t)+"' value='"+e+"'/>"},M=function(e,t){return"<span title='"+t+"' style='color: #aaaaaa;'>"+e+"</span>"};for(v in w){for(y=w[v],(s=n.get(OM.encodeAsIdentifier(v)))&&y.push(n),k=function(e,t){return strictNodeComparator(e.open,t.open)},x=v+" "+f("&#x1f589;",["edit key",v],!1,"Edit attribute key"),j=y.sort(k),I=0,T=j.length;T>I;I++)if(a=j[I],a===n)if(m=OM.decode(s.m),"a"===m.type&&m.children[0].equals(Group.prototype.listSymbol))for(H=m.children.slice(1),h=C=0,W=H.length;W>C;h=++C)b=H[h],i(x,e(b)+" "+("st"===b.type?f("&#x1f589;",["edit from internal list",v,h],!1,"Edit attribute"):M("&#x1f589;","Cannot edit -- not atomic")),"hidden "+f("&#x1f441;",["show",v],!1,"Show attribute"),f("&#10007;",["remove from internal list",v,h],!1,"Remove attribute")),x="";else i(x,e(m)+" "+("st"===m.type?f("&#x1f589;",["edit internal solo",v],!1,"Edit attribute"):M("&#x1f589;","Cannot edit -- not atomic")),"hidden "+f("&#x1f441;",["show",v],!1,"Show attribute"),f("&#10007;",["remove internal solo",v],!1,"Remove attribute")),x="";else b=a.canonicalForm(),i(x,e(b)+" "+("st"===b.type?f("&#x1f589;",["edit external",a.id()],!1,"Edit attribute"):M("&#x1f589;","Cannot edit -- not atomic")),"visible "+f("&#x1f441;",["hide",v],!1,"Hide attribute"),f("&#10007;",["remove external",a.id()],!1,"Remove attribute")),x="";o()}return O+="</table>",0===Object.keys(w).length&&(O+="<p>The expression has no attributes.</p>",o()),O+="<center><p>"+f("<b>+</b>",["add attribute"],!1,"Add new attribute")+"</p></center>",tinymce.activeEditor.Dialogs.alert({title:"Attributes",message:O,width:600,onclick:function(e){var i,o,c,d,s,u;try{u=l(e.id),d=u[0],v=u[1],h=u[2]}catch(p){}if("remove from internal list"===d?(o=OM.encodeAsIdentifier(v),c=n.get(o),b=OM.decode(c.m),b=OM.app.apply(OM,[b.children[0]].concat(t.call(b.children.slice(1,h+1)),t.call(b.children.slice(h+2)))),s=decompressWrapper(c.v),s=s.split("\n"),s.splice(h,1),s=s.join("\n"),c={m:b.encode(),v:compressWrapper(s)},n.plugin.editor.undoManager.transact(function(){return n.set(o,c)}),r()):"remove internal solo"===d?(n.plugin.editor.undoManager.transact(function(){return n.clear(OM.encodeAsIdentifier(v))}),r()):"remove external"===d?(n.plugin.editor.undoManager.transact(function(){return tinymce.activeEditor.Groups[v].disconnect(n)}),r()):"show"===d?(n.unembedAttribute(v),r()):"hide"===d?(n.embedAttribute(v),r()):"edit key"===d&&tinymce.activeEditor.Dialogs.prompt({title:"Enter new key",message:'Change "'+v+'" to what?',okCallback:function(e){return/^[a-zA-Z0-9-_]+$/.test(e)?n.attributeGroupsForKey(e).length>0?void tinymce.activeEditor.Dialogs.alert({title:"Invalid key",message:"That key is already in use by a different attribute.",width:300,height:200}):tinymce.activeEditor.undoManager.transact(function(){var t,i,o,c,l,d;for(t=n.attributeGroupsForKey(v),d=0,l=t.length;l>d;d++)a=t[d],a.set("key",e);return i=OM.encodeAsIdentifier(v),o=OM.encodeAsIdentifier(e),c=n.get(i),n.clear(i),n.set(o,c),r()}):void tinymce.activeEditor.Dialogs.alert({title:"Invalid key",message:"Keys can only contain Roman letters, decimal digits, hyphens, and underscores (no spaces or other punctuation).",width:300,height:200})}}),"edit from internal list"===d)return tinymce.activeEditor.Dialogs.prompt({title:"Enter new value",message:"Provide the new content of the atomic expression.",okCallback:function(e){var t;return o=OM.encodeAsIdentifier(v),c=n.get(o),b=OM.decode(c.m),b.children[h+1].tree.v=e,s=decompressWrapper(c.v),s=s.split("\n"),(t=/^<([^>]*)>([^<]*)<(.*)$/.exec(s[h]))?(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),s[h]="<"+t[1]+">"+e+"<"+t[3],s=s.join("\n"),c={m:b.encode(),v:compressWrapper(s)},n.plugin.editor.undoManager.transact(function(){return n.set(o,c)}),r()):void 0}});if("edit internal solo"===d)return tinymce.activeEditor.Dialogs.prompt({title:"Enter new value",message:"Provide the new content of the atomic expression.",okCallback:function(e){var t;return o=OM.encodeAsIdentifier(v),c=n.get(o),b=OM.decode(c.m),b.tree.v=e,s=decompressWrapper(c.v),(t=/^<([^>]*)>([^<]*)<(.*)$/.exec(s))?(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),s="<"+t[1]+">"+e+"<"+t[3],c={m:b.encode(),v:compressWrapper(s)},n.plugin.editor.undoManager.transact(function(){return n.set(o,c)}),r()):void 0}});if("edit external"===d)return tinymce.activeEditor.Dialogs.prompt({title:"Enter new value",message:"Provide the new content of the atomic expression.",okCallback:function(e){return n.plugin[v].setContentAsText(e),r()}});if("add attribute"===d){for(h=1,v=function(){return OM.encodeAsIdentifier("attribute"+h)};n.get(v());)h++;return b=OM.string("edit this"),i=function(e){var t;return t=grouperHTML("expression",e,0,!1),"open"===e&&(t=t.replace("grouper","grouper mustreconnect")),t},s=i("open")+b.value+i("close"),c={m:b.encode(),v:compressWrapper(s)},n.plugin.editor.undoManager.transact(function(){return n.set(v(),c)}),r()}}})}}}).call(this);
//# sourceMappingURL=main-app-attr-dialog-solo.min.js.map