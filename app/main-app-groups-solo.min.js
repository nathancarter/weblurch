(function(){var t,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},e=[].slice;window.groupTypes=[{name:"expression",text:"Expression",imageHTML:'<font color="#996666">[ ]</font>',openImageHTML:'<font color="#996666">[</font>',closeImageHTML:'<font color="#996666">]</font>',tooltip:"Make the selected text an expression",color:"#996666",shortcut:"meta+[",LaTeXshortcut:"\\[",connectionRequest:function(t,n){var e;return e=function(t,n){var o,r,i,u,a;if(t===n)return!0;for(a=t.connectionsOut(),i=0,u=a.length;u>i;i++)if(o=a[i],r=tinymce.activeEditor.Groups[o[1]],e(r,n))return!0;return!1},e(n,t)?t.plugin.editor.Dialogs.alert({title:"Cannot connect expressions",message:"Forming that connection would create a cycle of connections among expressions, which is not permitted."}):tinymce.activeEditor.undoManager.transact(function(){return t.connect(n),t.get("key")||t.set("key","label"),t.get("keyposition")?void 0:t.set("keyposition","arrow")})},connections:function(t){var o,r,i,u,a,s,c,l,g,f,p,h,d;if(t instanceof ProtoGroup){for(a=null!=(h=t.connections)?h:[],l=0,f=a.length;f>l;l++)o=a[l],o instanceof Array&&(n.call(o,2)<0&&(o[2]=""),o[3]=function(t){return t.globalAlpha=.5,t.setLineDash([2,2])});return a}for(u=t.connectionsOut(),i=t.connectionsIn(),d=e.call(i).concat(e.call(u)),g=0,p=d.length;p>g;g++)r=d[g],s=tinymce.activeEditor.Groups[r[0]],"arrow"===s.get("keyposition")&&(r[2]=s.get("key")),"premise"===s.get("key")&&(r[3]=function(t){return t.setLineDash([3,3])});return e.call(u).concat(e.call(i),e.call(function(){var t,n,e;for(e=[],t=0,n=u.length;n>t;t++)c=u[t],e.push(c[1]);return e}()),e.call(function(){var t,n,e;for(e=[],t=0,n=i.length;n>t;t++)c=i[t],e.push(c[0]);return e}()))},tagContents:function(t){return t instanceof ProtoGroup?t.tagContents:"source"===t.get("keyposition")?t.get("key"):null},tagMenuItems:function(n){var e;return e=[],n instanceof ProtoGroup?e.push({text:"Accept suggestion",shortcut:"Meta+J",onclick:function(){return n.promote()}}):n.connectionsOut().length>0&&"source"===n.get("keyposition")&&(e.push({text:'Move "'+n.get("key")+'" onto arrow',onclick:function(){return tinymce.activeEditor.undoManager.transact(function(){return n.set("keyposition","arrow")})}}),e.push(t(n))),e},contextMenuItems:function(n){var e,o,r,i,u,a,s,c,l,g,f,p,h,d,y,v;if(c=[],i=n.connectionsOut(),u=n.get("key"),i.length>0&&("arrow"===n.get("keyposition")&&c.push({text:'Move "'+n.get("key")+'" onto attribute',onclick:function(){return tinymce.activeEditor.undoManager.transact(function(){return n.set("keyposition","source")})}}),c.push(t(n))),i.length>0&&"premise"!==u){for(p=function(){var t,n,e;for(e=[],t=0,n=i.length;n>t;t++)r=i[t],e.push(tinymce.activeEditor.Groups[r[1]]);return e}(),e=!0,h=0,y=p.length;y>h;h++)if(f=p[h],f.attributeGroupsForKey(u).length>1){e=!1;break}if(e)c.push({text:"Hide this attribute",onclick:function(){var t,e,o;return t=function(){return tinymce.activeEditor.undoManager.transact(function(){var t,e,o,r,i;for(i=[],t=o=0,r=p.length;r>o;t=++o)f=p[t],e=t===p.length-1,f.embedAttribute(u,e),i.push(e?void 0:n.connect(p[t+1]));return i})},o="",p.length>1&&(o+="You are hiding this attribute in "+p.length+" expressions.  "),e=n.attributionAncestry(!0).length-n.attributionAncestry(!1).length,e>0&&(o+="There are "+e+" premise connections that will be broken if you hide that attribute.  "),o.length>0?tinymce.activeEditor.Dialogs.confirm({title:"Warning",message:""+o+"Continue anyway?",okCallback:t}):t()}});else if(1===p.length){for(f=p[0],g=f.attributeGroupsForKey(u),o=!1,d=0,v=g.length;v>d;d++)if(l=g[d],l.connectionsOut().length>1){o=!0;break}o||c.push({text:"Hide this attribute",onclick:function(){var t,e,o,r,i;for(t=function(){return tinymce.activeEditor.undoManager.transact(function(){var t,e,o,r,i;for(i=[],t=o=0,r=p.length;r>o;t=++o)f=p[t],e=t===p.length-1,f.embedAttribute(u,e),i.push(e?void 0:n.connect(p[t+1]));return i})},o="You are about to hide not one attribute, but "+g.length+", all of type "+u+".  ",e=0,r=0,i=g.length;i>r;r++)l=g[r],e+=l.attributionAncestry(!0).length-l.attributionAncestry(!1).length;return e>0&&(o+="There are "+e+" premise connections that will be broken if you hide that attribute.  "),o.length>0?tinymce.activeEditor.Dialogs.confirm({title:"Warning",message:""+o+"Continue anyway?",okCallback:t}):t()}})}}return c.push({text:"Attributes...",onclick:window.attributesActionForGroup(n)}),(a=n.lookupAttributes("code")).length>0&&(s=a[a.length-1],s instanceof Group&&(s=s.canonicalForm()),"st"===s.type&&c.push({text:"Edit as code...",onclick:function(){return n.plugin.editor.Dialogs.codeEditor({value:n.contentAsCode(),okCallback:function(t){return n.plugin.editor.undoManager.transact(function(){return n.setContentAsCode(t)})}})}})),c},clicked:function(t,n,e){return"double"===n&&"close"===e?tinymce.activeEditor.Dialogs.waiting({title:"Just sit tight",message:"Waiting...",work:function(n){return t.computeValidationAsync(function(t){var e;return n(),tinymce.activeEditor.Dialogs.alert({title:"Validation details",message:"<table> <tr><td>Result:</td> <td>"+t.result+"</td></tr> <tr><td>Explanation:</td> <td>"+t.message+"</td></tr> <tr><td>Details:</td> <td>"+(null!=(e=t.verbose)?e:"(none available)")+"</td></tr> </table>"})},!0)}}):void 0},setOutlineStyle:function(t,n){return t instanceof ProtoGroup?(n.globalAlpha=.5,n.setLineDash([2,2])):void 0},setFillStyle:function(t,n){return t instanceof ProtoGroup?(n.globalAlpha=.35,n.setLineDash([2,2])):void 0}}],window.afterEditorReadyArray.push(function(t){var e,o,r,i,u,a;return i=["and+","and-","or+","or-","implies+","implies-","not+","not-","forall+","forall-","exists+","exists-","=+","=-"],r=function(t){return/^[ 0-9\.+*\/\^-]+$/.test(t)&&/[0-9]/.test(t)},a=function(n){var u,a,s,c,l;if(t.Groups.groupsTouchingRange(n).length>0)return!1;for(u=function(r,i){var u,a,s;return null==i&&(i="Suggestion:"),s=new ProtoGroup(n,t.Groups.groupTypes.expression),s.tagContents=r?"Reason?":"Expression?",s.isAReason=r,(a=e(n,r))&&(u=a.id(),o(a)?s.connections=[[u,s,""],u]:s.connections=[[s,u,""],u]),s},s=n.toString(),c=0,l=i.length;l>c;c++)if(a=i[c],a===s)return u(!0);return r(s)?u(!1):!1},e=function(n,e){var r,i,u,a,s,c,l;if(i=function(t){return null!=(null!=t?t.id():void 0)&&!t.deleted&&0===t.connectionsIn().length&&0===t.connectionsOut().length},a=function(t){return e!==o(t)},c=null!=(l=ProtoGroup.lastPromoted)?l.promotedTo:void 0,i(c)&&a(c))return c;if(s=t.Groups.grouperIndexOfRangeEndpoint(n,!0),s>-1){if(r=t.Groups.allGroupers(),u=t.Groups.grouperToGroup(r[s]),i(u)&&a(u))return u;if(u=t.Groups.grouperToGroup(r[s+1]),i(u)&&a(u))return u}return null},o=function(t){return"reason"===t.get("key")},u=function(){var e,o,r,u,s,c,l,g,f,p,h,d,y,v,m;if(s=t.selection.getRng(),!s.collapsed)return a(s);if(l=s.cloneRange(),l.includeWholeWords(),u=a(l))return u;for(r=[],g=0,h=i.length;h>g;g++)c=i[g],v=c.length,n.call(r,v)<0&&r.push(c.length);for(r.sort(function(t,n){return n-t}),f=0,d=r.length;d>f;f++)for(o=r[f],m=allRangesNearCursor(o),p=0,y=m.length;y>p;p++)if(e=m[p],u=a(e))return u;return!1},t.on("NodeChange KeyUp change setContent",function(n){var e,o;return t.Groups.groupTypes.expression.suggestions=(e=u())?[e]:[],null!=(o=t.Overlay)?o.redrawContents():void 0}),t.Groups.visibleGroups=function(){var n;return null!=(n=t.Groups.groupTypes.expression.suggestions)?n:[]},t.shortcuts.add("Meta+J","",function(){var n,e;return null!=(n=t.Groups.groupTypes.expression.suggestions)&&null!=(e=n[0])?e.promote():void 0})}),t=function(t){var n,e;return e=function(n){return tinymce.activeEditor.undoManager.transact(function(){return t.set("key",n)})},n=function(t){return{text:t,onclick:function(){return e(t.toLowerCase())}}},{text:"Change attribute key to...",menu:[n("Label"),n("Reason"),n("Premise"),n("Rule"),n("Code"),{text:"Other...",onclick:function(){return tinymce.activeEditor.Dialogs.prompt({title:"Enter new key",message:'Change "'+t.get("key")+'" to what?',okCallback:function(t){return/^[a-zA-Z0-9-_]+$/.test(t)?e(t):void tinymce.activeEditor.Dialogs.alert({title:"Invalid key",message:"Keys can only contain Roman letters, decimal digits, hyphens, and underscores (no spaces or other punctuation).",width:300,height:200})}})}}]}}}).call(this);
//# sourceMappingURL=main-app-groups-solo.min.js.map